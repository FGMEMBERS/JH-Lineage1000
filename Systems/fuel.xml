<?xml version="1.0"?>  

<system name="fuel">
  <!-- ac1, ac2, dc; 0=OFF, 1=AUTO, 2=ON-->
  <!-- xfeed; -1=LEFT TANK, 0=XFEED, 1=RIGHT TANK-->
  <property value="1">/controls/fuel/valves/ac1</property>
  <property value="1">/controls/fuel/valves/ac2</property>
  <property value="1">/controls/fuel/valves/dc</property>
  <property value="0">/controls/fuel/valves/xfeed</property>
  <property value="0">systems/fuel/flows/auxiliar-wing-tank-flow</property>
  
  <channel name="Fuel Xfeed">
    <switch name="fuel-AC1">
      <default value="/controls/fuel/valves/ac1"/>
      <output>systems/fuel/ac1-switch</output>
    </switch>
    <switch name="fuel-AC2">
      <default value="/controls/fuel/valves/ac2"/>
      <output>systems/fuel/ac2-switch</output>
    </switch>
    <switch name="fuel-DC">
      <default value="/controls/fuel/valves/dc"/>
      <output>systems/fuel/dc-switch</output>
    </switch>
    <switch name="fuel-XFEED">
      <default value="/controls/fuel/valves/xfeed"/>
      <output>systems/fuel/xfeed-switch</output>
    </switch>
  </channel>

  <channel name="Electrical Busses">
    <switch name="ac-bus1">
      <default value="0"/>
      <test logic="OR" value="1">
	/systems/electrical/left-bus gt 10
      </test>
      <output>systems/fuel/electrical/ac-bus1</output>
    </switch>
    <switch name="ac-bus2">
      <default value="0"/>
      <test logic="OR" value="1">
	/systems/electrical/right-bus gt 10
      </test>
      <output>systems/fuel/electrical/ac-bus2</output>
    </switch>
    <switch name="RAT">
      <default value="/controls/electric/ram-air-turbine"/>
      <output>systems/fuel/electrical/RAT</output>
    </switch>
    <switch name="dc-bus1">
      <default value="0"/>
      <test logic="OR" value="1">
	/controls/electric/APU-generator == 1
	/controls/electric/external-power == 1
	/systems/electrical/right-bus gt 3
      </test>
      <output>systems/fuel/electrical/dc-bus1</output>
    </switch>
    <switch name="dc-bus2">
      <default value="0"/>
      <test logic="OR" value="1">
	/controls/electric/APU-generator == 1
	/controls/electric/external-power == 1
	/systems/electrical/left-bus gt 3
      </test>
      <output>systems/fuel/electrical/dc-bus2</output> 
    </switch>
  </channel>

  <channel name="XFEED">
    <!-- 0:No Xfeed, 1:Both tanks Xfeed,
	 2:Left Tank Xfeed, 3:Right Tank Xfeed-->
    <switch name="xfeed configuration">
      <default value="0"/>
      <test logic="OR" value="0">
	/systems/electrical/right-bus le 15
	/systems/electrical/right-bus le 15
      </test>
      <test value="1">
	systems/fuel/xfeed-switch == 0
      </test>
      <test value="2">
	systems/fuel/xfeed-switch == -1
      </test>
      <test value="3">
	systems/fuel/xfeed-switch == 1
      </test>
      <output>systems/fuel/pump/xfeed-status</output>
    </switch>
    <!-- AC and DC pumps, XFEED off; 0: OFF, 1: AUTO or ON -->
    <switch name="AC PUMP 1 Status">
      <default value="0"/>
      <test logic="OR" value="0">
	systems/fuel/electrical/ac-bus1 == 0
	systems/fuel/pump/xfeed-status != 0
      </test>
      <test value="1">
	systems/fuel/ac1-switch != 0
      </test>
      <output>systems/fuel/pump/ac1-status</output>
    </switch>
    <switch name="AC PUMP 2 Status">
      <default value="0"/>
      <test logic="OR" value="0">
	systems/fuel/electrical/ac-bus2 == 0
	systems/fuel/pump/xfeed-status != 0
      </test>
      <test value="1">
	systems/fuel/ac2-switch != 0
      </test>
      <output>systems/fuel/pump/ac2-status</output>
    </switch>
    <switch name="DC PUMP  Status">
      <default value="0"/>
      <test logic="OR" value="0">
	systems/fuel/electrical/dc-bus1 == 0
	systems/fuel/pump/xfeed-status != 0
	systems/fuel/pump/ac1-status != 0
	systems/fuel/pump/ac2-status != 0
      </test>
      <test value="1">
	systems/fuel/dc-switch != 0
      </test>
      <output>systems/fuel/pump/dc-status</output>
    </switch>
  </channel>

  <channel name="Pumps powered">
    <switch name="Left wing powered">
      <default value="0"/>
      <test value="1">
	/controls/fuel/tank[6]/boost-pump[0] == 1
	/controls/fuel/tank[6]/boost-pump[1] == 1
      </test>
      <output>systems/fuel/pump/left-powered</output>
    </switch>
    <switch name="Right wing powered">
      <default value="0"/>
      <test value="1">
	/controls/fuel/tank[7]/boost-pump[0] == 1
	/controls/fuel/tank[7]/boost-pump[1] == 1
      </test>
      <output>systems/fuel/pump/right-powered</output>
    </switch>
  </channel>

  <channel name="Fuel injectors">
    <summer name="Left engine injector">
      <input>propulsion/engine[0]/fuel-flow-rate-pps</input>
      <output>systems/fuel/flows/left-injector-rate-pps</output>
    </summer>
    <summer name="Right engine injector">
      <input>propulsion/engine[1]/fuel-flow-rate-pps</input>
      <output>systems/fuel/flows/right-injector-rate-pps</output>
    </summer>
  </channel>
  
  <channel name="XFEED Fuel distributors">
    <summer name="xfeed-unilateral">
      <input>systems/fuel/flows/left-injector-rate-pps</input>
      <input>systems/fuel/flows/right-injector-rate-pps</input>
      <output>systems/fuel/flows/unilateral-injector-rate-pps</output>
    </summer>
    
    <switch name="Left Draw">
      <default value="systems/fuel/flows/unilateral-injector-rate-pps"/>
      <test logic="OR" value="0">
	systems/fuel/pump/left-powered == 0
	systems/fuel/pump/xfeed-status == 0
	systems/fuel/pump/xfeed-status == 3
	propulsion/tank[0]/contents-lbs == 0
      </test>
      <test value="systems/fuel/flows/left-injector-rate-pps">
	systems/fuel/pump/xfeed-status == 1
	propulsion/tank[0]/contents-lbs gt 0	
      </test>
      <output>systems/fuel/flows/left-draw</output>
    </switch>
    <switch name="Right Draw">
      <default value="systems/fuel/flows/unilateral-injector-rate-pps"/>
      <test logic="OR" value="0">
	systems/fuel/pump/right-powered == 0
	systems/fuel/pump/xfeed-status == 0
	systems/fuel/pump/xfeed-status == 2
	propulsion/tank[4]/contents-lbs == 0
      </test>
      <test value="systems/fuel/flows/right-injector-rate-pps">
	systems/fuel/pump/xfeed-status == 1
	propulsion/tank[4]/contents-lbs gt 0	
      </test>
      <output>systems/fuel/flows/right-draw</output>
    </switch>

    <!--XFEED aux tanks flow into wings while not empty-->
    <switch name="xfeed tail trimmer">
      <default value="systems/fuel/flows/unilateral-injector-rate-pps"/>
      <test logic="OR" value="0.0">
	propulsion/tank[5]/contents-lbs == 0
	systems/fuel/pump/xfeed-status == 0
      </test>
      <output>systems/fuel/flows/trimmer-draw-rate</output>
    </switch>
    <switch name="central fuel tank">
      <default value="systems/fuel/flows/unilateral-injector-rate-pps"/>
      <test logic="OR" value="0.0">
	propulsion/tank[1]/contents-lbs == 0
	propulsion/tank[2]/contents-lbs gt 0
	propulsion/tank[3]/contents-lbs gt 0
      	propulsion/tank[5]/contents-lbs gt 0
	systems/fuel/pump/xfeed-status == 0
      </test>
      <output>systems/fuel/flows/central-draw-rate</output>      
    </switch>
    <switch name="xfeed fwd aux">
      <default value="systems/fuel/flows/left-injector-rate-pps"/>
      <test logic="OR" value="0.0">
	propulsion/tank[5]/contents-lbs gt 0
	propulsion/tank[2]/contents-lbs == 0
	systems/fuel/pump/xfeed-status == 0
      </test>
      <output>systems/fuel/flows/fwdaux-draw-rate</output>
    </switch>
    <switch name="xfeed rear aux">
      <default value="systems/fuel/flows/right-injector-rate-pps"/>
      <test logic="OR" value="0.0">
	propulsion/tank[5]/contents-lbs gt 0
	propulsion/tank[3]/contents-lbs == 0
	systems/fuel/pump/xfeed-status == 0
      </test>
      <output>systems/fuel/flows/rearaux-draw-rate</output>
    </switch>
    <summer name="unilateral aux collect">
      <input>systems/fuel/flows/trimmer-draw-rate</input>
      <input>systems/fuel/flows/central-draw-rate</input>
      <input>systems/fuel/flows/fwdaux-draw-rate</input>
      <input>systems/fuel/flows/rearaux-draw-rate</input>
      <output>systems/fuel/flows/unilateral-aux-collect-rate</output>
    </summer>
    <pure_gain name="systems/fuel/flows/bilateral-aux-collect-rate">
      <input>systems/fuel/flows/unilateral-aux-collect-rate</input>
      <gain>0.5</gain>
    </pure_gain>
    <switch name="Left collect">
      <default value="systems/fuel/flows/bilateral-aux-collect-rate"/>
      <test value="systems/fuel/flows/unilateral-aux-collect-rate">
	systems/fuel/pump/xfeed-status == 2
      </test>
      <output>systems/fuel/flows/left-aux-collect-rate</output>
    </switch>
    <switch name="Right collect">
      <default value="systems/fuel/flows/bilateral-aux-collect-rate"/>
      <test value="systems/fuel/flows/unilateral-aux-collect-rate">
	systems/fuel/pump/xfeed-status == 3
      </test>
      <output>systems/fuel/flows/right-aux-collect-rate</output>
    </switch>
    <summer name="tanks total draw">
      <input>systems/fuel/flows/left-draw</input>
      <input>systems/fuel/flows/right-draw</input>
      <output>systems/fuel/flows/xfeed-draw</output>
    </summer>
    <pure_gain name="systems/fuel/flows/collector-feed">
      <input>systems/fuel/flows/xfeed-draw</input>
      <gain>0.5</gain>
    </pure_gain>
    
    <!--XFEED Fuel transferance -->
    <summer name="Left collector refeed from wing tanks">
      <input>systems/fuel/flows/collector-feed</input>
      <output>propulsion/tank[6]/external-flow-rate-pps</output>
    </summer>
    <summer name="Right collector refeed from wing tanks">
      <input>systems/fuel/flows/collector-feed</input>
      <output>propulsion/tank[7]/external-flow-rate-pps</output>
    </summer>
    <summer name="Left wing tank">
      <input>-systems/fuel/flows/left-draw</input>
      <input>systems/fuel/flows/left-aux-collect-rate</input>
      <output>propulsion/tank[0]/external-flow-rate-pps</output>
    </summer>
    <summer name="Right wing tank">
      <input>-systems/fuel/flows/right-draw</input>
      <input>systems/fuel/flows/right-aux-collect-rate</input>
      <output>propulsion/tank[4]/external-flow-rate-pps</output>
    </summer>
    <summer name="Central tank">
      <input>-systems/fuel/flows/central-draw-rate</input>
      <output>propulsion/tank[1]/external-flow-rate-pps</output>
    </summer>
    <summer name="Fwd Aux tank">
      <input>-systems/fuel/flows/fwdaux-draw-rate</input>
      <output>propulsion/tank[2]/external-flow-rate-pps</output>
    </summer>
    <summer name="Rear Aux tank">
      <input>-systems/fuel/flows/rearaux-draw-rate</input>
      <output>propulsion/tank[3]/external-flow-rate-pps</output>
    </summer>
    <summer name="Tail Trimmer Aux tank">
      <input>-systems/fuel/flows/trimmer-draw-rate</input>
      <output>propulsion/tank[5]/external-flow-rate-pps</output>
    </summer>    
  </channel>

</system>
